<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>GPXParser | OpenSource GPX format JavaScript parser</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="./GPXParser.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      function meters2feet(d) {

      }
      function meters2nm(d) {
	  return(d*0.000539957);
      }
      function load_gpx() {
	  var input = document.getElementById("customFile");
	  var fr=new FileReader();
	  
	  fr.readAsText(input.files[0]);
	  var gpx_data;
	  fr.onload=function(){
	      var gpx = new gpxParser();
	      gpx.parse(fr.result);
	      render_segments(gpx);
          }
	  
	  //          window.location = "./test.html";
      }

      function get_previous_point(gpx,time) {
	  
      }

      function find_splits(gpx) {
	  var lastTime;
	  var split_dates = [];
	  var diff;  // difference in milliseconds
	  gpx.tracks.forEach(function(track) {
	      track.points.forEach(function(point) {
		  if (lastTime) {
		      diff = point.time - lastTime;
		      if ((diff * 1000) >  60) {
			  split_dates.push(point.time);
		      }
		  }
		  lastTime = point.time;
	      });
	  });
	  return(split_dates);
      }
      
      function render_segments(gpx) {
	  var segments = $("#segments");
	  var table = segments.find("#segment-table");

	  splits = find_splits(gpx);

	  splits.forEach(function(time) {
	      var row = $("<tr></tr");
	      var distance = meters2nm(item.distance.cumul[item.distance.cumul.length -1]);
	      row.append($("<td></td>").text(time));
	      row.append($("<td></td>").text(item.name));
	      row.append($("<td></td>").text(item.name));
	      row.append($("<td></td>").text(distance));

	      table.append(row);
	  });
	  
	  segments.removeClass("collapse");
	  
      }
    </script>
  </head>
  <body>
    <section class="panel-blue demo" id="main">
      <h1>Start the demo</h1>
      <div class="container mt-5">
	<label class="form-label" for="customFile">Default file input example</label>
	<input type="file" class="form-control" id="customFile" />
	<input type="button" class="form-control" id="submit" value="Submit" onclick="load_gpx()" />
      </div>
    </section>
    <section class="panel-blue demo collapse" id="segments">
      <h1>GPS segments</h1>
      <div class="container mt-5">
	<table class="table" id="segment-table">
	  <thead>
	    <tr>
	      <th>Date</th>
	      <th>Origin</th>
	      <th>Destination</th>
	      <th>Distance</th>
	    </tr>
	  </thead>
	</table>
      </div>
    </section>
  </body>
</html>
