<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>GPXParser | OpenSource GPX format JavaScript parser</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="./GPXParser.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      function meters2feet(d) {

      }
      function meters2nm(d) {
		  return(d*0.000539957);
      }

	  function load_gpx() {
		var input = document.getElementById("customFile");
	  	var fr=new FileReader();

		
		fr.readAsText(input.files[0]);
		var gpx_data;
	  	fr.onload=function(){
			fetch('/process', {
				method: 'POST',
				body: JSON.stringify({ 'gpx': fr.result }),
				headers: {
				  'Content-Type': 'application/json'
				}
			  })
			  .then(res => res.json())
			  .then(d => {
				render_segments(d)
					})
		}
	  
      }

      function get_previous_point(gpx,time) {
	  
      }
      
      function render_segments(gpx_info) {
	  	var segments = $("#segments");
	  	var table = segments.find("#segment-table");

		var index = 0;
		table.find("[name='col']").remove();
		gpx_info.forEach(function(segment) {
	      var row = $("<tr></tr");
	      row.append($('<td name="col"></td>').text(segment.time));
	      row.append($('<td name="col"></td>').text(segment.depart));
	      row.append($('<td name="col"></td>').text(segment.arrive));
	      row.append($('<td name="col"></td>').text(segment.distance));
	      row.append($('<td name="col"></td>').text(segment.duration));
	      row.append($('<td name="col"></td>').text(segment.max_alt));
		  var text = $('<textarea id="description" name="description" rows="3" cols="80"></textarea>').text(segment.description);
		  row.append($('<td name="col"></td>').append(text));
	      table.append(row);
		  index++;
		});
	  
	  	segments.removeClass("collapse");
	  
      }
    </script>
  </head>
  <body>
    <section class="panel-blue demo" id="main">
      <h1>Start the demo???????</h1>
      <div class="container mt-5">
		<label class="form-label" for="customFile">GPX file</label>
		<input type="file" class="form-control" id="customFile" />
		<input type="button" class="form-control" id="submit" value="Submit" onclick="load_gpx()" />
      </div>
    </section>
    <section class="panel-blue demo collapse" id="segments">
      <h1>GPS segments</h1>
      <div class="container mt-5">
	<table class="table" id="segment-table">
	  <thead>
	    <tr>
	      <th>Date</th>
	      <th>Origin</th>
	      <th>Destination</th>
	      <th>Distance</th>
	      <th>Time</th>
	      <th>Altitude</th>
	      <th>Track Description</th>
	    </tr>
	</thead>
	</table>
      </div>
    </section>
  </body>
</html>
